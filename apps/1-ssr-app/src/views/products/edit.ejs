<%# This view provides the form for editing an existing product. %>
<%# It's rendered by `getEditProductForm` and its submission is handled by `updateProduct`. %>

<h1>Edit Product: <%= product.name %></h1>

<!--
  This form is almost identical to the "new" form. The key difference is the `action` URL,
  which now includes the product's ID to target the correct `update` route.
  The form fields are also pre-filled with the `product` data passed from the controller.
-->
<form action="/products/<%= product.id %>" method="POST">
    <div class="field-row-stacked">
        <label for="name">Product Name</label>
        <input id="name" name="name" type="text" value="<%= product.name %>" required>
    </div>
    <% if (locals.errors && errors.name) { %>
        <div class="error-message"><%= errors.name.msg %></div>
    <% } %>

    <div class="field-row-stacked">
        <label for="price">Price</label>
        <input id="price" name="price" type="number" step="0.01" value="<%= product.price %>" required>
    </div>
    <% if (locals.errors && errors.price) { %>
        <div class="error-message"><%= errors.price.msg %></div>
    <% } %>

    <div class="field-row-stacked">
        <label for="description">Description</label>
        <textarea id="description" name="description" rows="5" required><%= product.description %></textarea>
    </div>
    <% if (locals.errors && errors.description) { %>
        <div class="error-message"><%= errors.description.msg %></div>
    <% } %>

    <div class="field-row-stacked">
        <label for="categoryId">Category</label>
        <select id="categoryId" name="categoryId" required>
            <% categories.forEach(category => { %>
                <option value="<%= category.id %>" <%= (product.categoryId == category.id) ? 'selected' : '' %>>
                    <%= category.name %>
                </option>
            <% }) %>
        </select>
    </div>
    <% if (locals.errors && errors.categoryId) { %>
        <div class="error-message"><%= errors.categoryId.msg %></div>
    <% } %>

    <div class="form-actions">
        <button type="submit">Update Product</button>
        <a href="/products/<%= product.id %>">Cancel</a>
    </div>
</form>
